# 第九章-两级页表

## 单级页表存在的问题

- 每个进程都需要很多个连续的页框来存放其页表，有违分页存储希望实现的“离散存储”。
- 根据局部性原理，无需使整个页表常驻内存。

## 解决方案

借鉴离散存储进程的方式，离散存储进程的页表。

这个页表称为页目录表或外层页表或顶层页表。

## 具体实现

计算页框大小/页表项大小，将这么多个页表项合为一个二级页表，将各二级页表离散存入各页框中。构造一个页目录表（外层页表、顶层页表），记录二级页表在内存中的位置。

### 解决地址转换问题的途径
将拆分为 (一级页号, 二级页号, 页内偏移量) 的逻辑地址作如下运算：

1. 根据一级页号，查页目录表，找到该一级页号对应的二级页表所在的页框号
2. 拿到这个页框号，查其内容（二级页表），找二级页号在其中对应的页框号；
3. 将这个页框号乘以 bit 计量的页面大小，再加上页面偏移量即得物理地址。

### 解决局部性原理问题的途径

在需要访问页面时，才将页面调入内存。在页表项中作标记位，标记该页面是否已经调入内存。若想访问的页面不在内存中，则抛出缺页中断，然后将目标页面从外存调入内存。

## 多级页表

假如逻辑地址有 40 位，页面大小 4KB，页表项大小 4B，需要采用几级页表？

1. 4KB 换算为 2^12B，故逻辑地址后 12 位归页内偏移量，剩余 28 位。
2. 页面大小 2^12B，页表项大小 4B，所以每一层页表需要存放 2^10 个页表项，所以要占用 10 位。
3. 28/10 向上取整，故为三级页表，顶层页表用 8 位表示，以下两层用 10 位表示。
