# 第七章-基本地址变换结构

## 页表寄存器

操作系统通常准备一个页表寄存器（Page Table Register, PTR）存放页表在内存中的起始地址和页表长度。

进程未被执行时，页表的起始地址和长度放在进程的 PCB 内；进程被调度时，操作系统内核将这两个值移入 PTR 中。

## 操作系统进行逻辑地址与物理地址转换的过程

1. 内核程序恢复进程现场，恢复程序计数器现场，调取 PTR
2. 拆分待转换的逻辑地址，取其页号部分
3. 将此页号与 PTR 中记录的页表长度（最大页号）比较，若大于，则抛出越界中断
4. 若不超过，根据此页号找到页框号，用页框号和待转换逻辑地址的页内偏移量部分相加，得物理地址。

### 将页框存在页内的计算

由于页表项的大小很可能不是 2 的整数次幂，在计算页框大小除以页表项大小时，时，若有余数，那么余数部分必须跳过。

例如 4KB 的页面存放 3B 大小的页表项，那么

4096/3 = 1365 .. 1

则第 1366 个页表项（编号为 1365），应当跳过 1B 的页内碎片，存放到下一个页框中。

所以，可以把页表项扩充到 4 个字节，降低查找的困难。